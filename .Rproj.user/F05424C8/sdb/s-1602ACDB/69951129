{
    "contents" : "## Carregando os pacotes necessários\nlibrary(dplyr)\nlibrary(readr)\n\n## Pegando os dados de ocupação para selecinar somente gerentes e diretores\nocupacao <- read_delim(file = 'ocupacao.csv', delim = ':', col_names = F)\ncolnames(ocupacao) <- c('codigo', 'ocupacao')\n\n## Criando função que consulta o banco e retorna a mediana e média\nmedia_salario <- function(tabela, cod_municipio) {\n  \n  ## Carrega o dplyr que é necessário\n  library(dplyr)\n  \n  ## Consulta\n  cidade <- tabela %>%\n    select(município, cbo_ocupação_2002) %>%\n    filter(município == cod_municipio) %>%\n    summarise(total = n())\n  \n  cidade <- collect(cidade)\n  \n  return(cidade)\n}\n\n################################################################################\n## Pegando as variáveis no Monet.DB\n# Preparando um banco\n## Carregando pacotes\nlibrary(MonetDB.R)\n\n## Criando a conexão\ncon <- dbConnect(MonetDB(), host = 'localhost', \n                 dbname = 'rais2014',\n                 user = 'monetdb',\n                 password = 'monetdb')\n\n## Cria conexão para o dplyr\nmonetdb_conn <- src_monetdb(dbname = 'rais2014')\n\n## Busca e conecta a todas as tabelas\ntabelas <- dbListTables(monetdb_conn$con)\nfontes <- rep(0,length(tabelas))\n\nfor (i in 1:length(tabelas)) {\n  \n  fontes[i] <- tbl(monetdb_conn, tabelas[i])\n}\n\n## Cidades de interesse\ncidades <- c('Se-Aracaju', 'Pa-Belem', 'Mg-Belo Horizonte', 'Sc-Blumenau',\n             'Df-Brasilia', 'Sp-Campinas', 'Ms-Campo Grande', 'Rs-Caxias do Sul', \n             'Mt-Cuiaba', 'Pr-Curitiba', 'Sc-Florianopolis', 'Ce-Fortaleza',\n             'Go-Goiania', 'Pb-Joao Pessoa', 'Sc-Joinville', 'Pr-Londrina',\n             'Al-Maceio', 'Am-Manaus', 'Pr-Maringa', 'Rn-Natal', 'Rs-Porto Alegre',\n             'Pe-Recife', 'Sp-Ribeirao Preto', 'Rj-Rio de Janeiro',\n             'Ba-Salvador', 'Sp-Sao Jose dos Campos', 'Ma-Sao Luis', 'Sp-Sao Paulo',\n             'Sp-Sorocaba', 'Pi-Teresina', 'Mg-Uberlandia', 'Es-Vitoria')\n\n## Separando os códigos só das cidades de interesse\ncod_cidades <- read_delim('codigo_cidades.csv', delim = ':')\ncod_cidades <- subset(cod_cidades, subset = cod_cidades$municipio %in% cidades)\n\n#################################################################################\n## Pegando conexões para todos os estados\nsergipe <- tbl(monetdb_conn, 'rais_se')\npara <- tbl(monetdb_conn, 'rais_pa')\nminas <- tbl(monetdb_conn, 'rais_mg')\nsta_catarina <- tbl(monetdb_conn, 'rais_sc')\ndf <- tbl(monetdb_conn, 'rais_df')\nsao_paulo <- tbl(monetdb_conn, 'rais_sp')\nmato_grosso <- tbl(monetdb_conn, 'rais_mt')\nmato_grosso_sul <- tbl(monetdb_conn, 'rais_ms')\nrio_grande_sul <- tbl(monetdb_conn, 'rais_rs')\nparana <- tbl(monetdb_conn, 'rais_pr')\nceara <- tbl(monetdb_conn, 'rais_ce')\ngoias <- tbl(monetdb_conn, 'rais_go')\nparaiba <- tbl(monetdb_conn, 'rais_pb')\nalagoas <- tbl(monetdb_conn, 'rais_al')\namazonas <- tbl(monetdb_conn, 'rais_am')\nrio_grande_norte <- tbl(monetdb_conn, 'rais_rn')\npernambuco <- tbl(monetdb_conn, 'rais_pe')\nrj <- tbl(monetdb_conn, 'rais_rj')\nbahia <- tbl(monetdb_conn, 'rais_ba')\nmaranhao <- tbl(monetdb_conn, 'rais_ma')\npiaui <- tbl(monetdb_conn, 'rais_pi')\nespirito_santo <- tbl(monetdb_conn, 'rais_es')\n\n#################################################################################\n## Resultado da consulta da RAIS\nresultado <- data.frame(cidades = cidades, renda = rep(0,length(cidades)))\n\n# Aracaju\nresultado$renda[1] <- media_salario(sergipe, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[1]])\n\n# Belem \nresultado$renda[2] <- media_salario(para, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[2]])\n\n# BH\nresultado$renda[3] <- media_salario(minas, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[3]])\n\n# Blumenau\nresultado$renda[4] <- media_salario(sta_catarina, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[4]])\n\n# Brasilia\nresultado$renda[5] <- media_salario(df, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[5]])\n\n# Campinas\nresultado$renda[6] <- media_salario(sao_paulo, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[6]])\n\n# Campo grande\nresultado$renda[7] <- media_salario(mato_grosso_sul, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[7]])\n\n# Caxias do Sul\nresultado$renda[8] <- media_salario(rio_grande_sul, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[8]])\n\n# Cuiaba\nresultado$renda[9] <- media_salario(mato_grosso, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[9]])\n\n# Curitiba\nresultado$renda[10] <- media_salario(parana, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[10]])\n\n# Floripa\nresultado$renda[11] <- media_salario(sta_catarina, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[11]])\n\n# Fortaleza\nresultado$renda[12] <- media_salario(ceara, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[12]])\n\n# Goiania\nresultado$renda[13] <- media_salario(goias, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[13]])\n\n# Joao Pessoa\nresultado$renda[14] <- media_salario(paraiba, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[14]])\n\n# Joinville\nresultado$renda[15] <- media_salario(sta_catarina, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[15]])\n\n# Londrina\nresultado$renda[16] <- media_salario(parana, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[16]])\n\n# Maceio\nresultado$renda[17] <- media_salario(alagoas, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[17]])\n\n# Manaus\nresultado$renda[18] <- media_salario(amazonas, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[18]])\n\n# Maringa\nresultado$renda[19] <- media_salario(parana, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[19]])\n\n# Natal\nresultado$renda[20] <- media_salario(rio_grande_norte, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[20]])\n\n# Porto Alegre\nresultado$renda[21] <- media_salario(rio_grande_sul, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[21]])\n\n# Recife\nresultado$renda[22] <- media_salario(pernambuco, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[22]])\n\n# Ribeirão Preto\nresultado$renda[23] <- media_salario(sao_paulo, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[23]])\n\n# Rio de Janeiro\nresultado$renda[24] <- media_salario(rj, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[24]])\n\n# Salvador\nresultado$renda[25] <- media_salario(bahia, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[25]])\n\n# Sao Jose dos Campos\nresultado$renda[26] <- media_salario(sao_paulo, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[26]])\n\n# Sao Luis\nresultado$renda[27] <- media_salario(maranhao, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[27]])\n\n# Sao Paulo\nresultado$renda[28] <- media_salario(sao_paulo, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[28]])\n\n# Sorocaba\nresultado$renda[29] <- media_salario(sao_paulo, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[29]])\n\n# Teresina\nresultado$renda[30] <- media_salario(piaui, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[30]])\n\n# Uberlandia\nresultado$renda[31] <- media_salario(minas, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[31]])\n\n# Vitoria\nresultado$renda[32] <- media_salario(espirito_santo, cod_municipio = cod_cidades$codigo[cod_cidades$municipio == cidades[32]])\n\n## Mudando o nome das colunas\ncolnames(resultado) <- c('cidade', 'total_funcionarios')\nsave(resultado, file = 'total_funcionarios_por_municipio.rda')\nlibrary(xlsx)\nwrite.xlsx(resultado, file = 'total_funcionarios_por_municipio.xlsx')\n\n",
    "created" : 1443631958108.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "129578390",
    "id" : "69951129",
    "lastKnownWriteTime" : 1443632778,
    "path" : "/data/Endeavor/RAIS/total_fucionarios.R",
    "project_path" : "total_fucionarios.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}